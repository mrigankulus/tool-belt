<br>
<br>


<div class="blank-slate-tab" ng-if="APIScorecard.shouldShowBlankSlate">
    <i class="fa fa-info-circle"></i>

    <section>
        <p>This feature is disabled in the <strong>Production Environment</strong>.</p>
    </section>
</div>

<div class="container columns" ng-if="!APIScorecard.shouldShowBlankSlate">
    <section>
        <div class="columns with-borders">
            <section class="no-score-api-scorecard" ng-if="APIScorecard.apiNotAccountedFor">
                <h4 class="muted"> <i class="fa fa-warning no-scorecard-warning"></i> API Score not yet calculated.</h4>
                <button class="btn btn-sm btn-primary" ng-click="APIScorecard.reRunReport()">Calculate Score</button>
            </section>

            <section ng-if="!APIScorecard.apiNotAccountedFor">
                <h2 class="no-margin text-center">API Score: <span
                        class="score-box {{ APIScorecard.getScoreColor() }}">{{ APIScorecard.totalScore }}</span></h2>
                <br />
                <p class="muted text-center"><strong>Last Updated On:</strong> {{ APIScorecard.lastUpdatedOn}}</p>
            </section>

            <section>
                <div class="columns counts score-box-ranges">
                    <section class="text-center green">
                        <div class="count">Green</div>
                        <div class="count-label">0 - 10 points</div>
                    </section>
                    <section class="text-center yellow">
                        <div class="count">Yellow</div>
                        <div class="count-label">11 - 30 points</div>
                    </section>
                    <section class="text-center red">
                        <div class="count">Red</div>
                        <div class="count-label">31+ points</div>
                    </section>
                </div>
            </section>
        </div>

        <hr />

        <h4 class="muted">Score Breakdown &amp; Methodology </h4>
        <p class="muted">
            The score works like golf; the lower, the better. The score is generated by replaying the last 10 requests
            made to the endpoint
            using an unauthenticated user. If those requests are successful they will show up as violations in the table
            below. Other things
            such as application crashes and exceptions will be thrown into the mix as well. <br /> <br />
        </p>

        <ul class="formatted-list">
            <li>
                <div class="columns">
                    <section class="flex-3"><strong>Criteria</strong></section>
                    <section class="flex-1 text-center"><strong>Value/Weight</strong></section>
                    <section class="flex-1 text-center"><strong>Occurrences/Violations</strong></section>
                    <section class="flex-1 text-center"><strong>Points</strong></section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">How many times has your app crashed in the past 24 hours?</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-crash') }} per crash
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.applicationCrashCount }}</section>
                    <section class="flex-1 text-center">{{ APIScorecard.applicationCrashPoints }}
                    </section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">How many application exceptions were logged in Splunk in the past 24 hours?
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-exception') }} per
                        exception</section>
                    <section class="flex-1 text-center">{{ APIScorecard.applicationErrorCount }}</section>
                    <section class="flex-1 text-center">{{ APIScorecard.applicationErrorPoints }}</section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">Are your docs accessible to external users?</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-docs-insecure') }} if
                        accessible</section>
                    <section class="flex-1 text-center">
                        {{ APIScorecard.insecureDocumentationCount }}</section>
                    <section class="flex-1 text-center">
                        {{ APIScorecard.insecureDocumentationPoints }}</section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">Is your endpoint secured against GET requests?</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-get-insecure') }} per
                        unsecured request</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getRequestCount }}
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.getRequestPoints }}
                    </section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">Is your endpoint secured against POST requests?</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-post-insecure') }} per
                        unsecured request</section>
                    <section class="flex-1 text-center">{{ APIScorecard.postRequestCount }}
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.postRequestPoints }}
                    </section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-3">Is your endpoint secured against PUT requests?</section>
                    <section class="flex-1 text-center">{{ APIScorecard.getValue('application-put-insecure') }} per
                        unsecured request</section>
                    <section class="flex-1 text-center">{{ APIScorecard.putRequestCount }}
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.putRequestPoints }}
                    </section>
                </div>
            </li>
            <li>
                <div class="columns">
                    <section class="flex-5 text-right"><strong>Total:</strong>
                    </section>
                    <section class="flex-1 text-center">{{ APIScorecard.totalScore }}
                    </section>
                </div>
            </li>
        </ul>
        </hr>
        <br>

        <div class="alert alert-warning text-center" ng-if="APIScorecard.exceptionCreatedFlag">
            We recommend you Recalculate the API
            Score in order for the exception to be accounted for in the API Scorecard.
        </div>

        <div class="alert text-center" ng-if="APIScorecard.isProcessingReport">
            <h4 class="muted">This may take a few minutes....</h4>
            <i class="fa fa-spinner api-scorecard fa-spin"></i>
        </div>
        <div class="columns with-borders">
            <section>
                <button class="btn btn-sm btn-primary btn-retry" ng-click="APIScorecard.reRunReport()">Calculate
                    Score</button>
                <h4>Alerts</h4>
                <p class="muted">
                    URLs that are unsecured or causing errors.
                </p>
                <hr>
                <ul class="formatted-list">
                    <li ng-repeat="alert in APIScorecard.allUrlAlerts">

                        <span ng-if="alert.method !== 'GET'">
                            <i class="fa fa-caret-down show-detail" ng-if="alert.showDetails"
                                ng-click="alert.showDetails = !alert.showDetails"> </i>
                            <i class="fa fa-caret-right show-detail" ng-if="!alert.showDetails"
                                ng-click="alert.showDetails = true"> </i></span>
                        <span class="get-method-caret" ng-if="alert.method == 'GET'"></span>
                        <button
                            ng-click="APIScorecard.addAlertToException(alert); wwtFocusPanelSVC.togglePanel('newExceptionForm')"
                            class="btn btn-xs btn-link btn-delete-exception btn-exng-click-active">Add </button>
                        <strong style="color: red"> {{ alert.method }} &nbsp;</strong> <a title="{{ alert.url }}"
                            href="#">{{ alert.url | truncate  }}</a>
                        <section ng-show="alert.showDetails">
                            <h6><strong>REQUEST BODY</strong></h6>
                            <json-formatter json="alert.requestBody" open="0"></json-formatter>
                        </section>
                    </li>
                </ul>
            </section>

            <section>
                <button class="btn btn-sm btn-primary btn-exception"
                    ng-click="APIScorecard.isEditingException = { isAddingNewException: true}; wwtFocusPanelSVC.togglePanel('newExceptionForm');"><i
                        class="fa fa-plus"></i> Add Exception
                </button>
                <a class="btn btn-link btn-xs btn-import-export" ui-sref="importExportScorecard">Import/Export</a>
                <h4>Exceptions</h4>
                <p class="muted">
                    URLs that are excluded from the API Score.
                </p>
                <hr>
                <ul class="formatted-list">
                    <li ng-repeat="exception in APIScorecard.allUrlExceptions">
                        <strong style="color: orange"> {{ exception.method }} &nbsp;</strong> <a href="#">
                            {{ exception.urlPathPattern }}</a>
                        <button
                            ng-click="APIScorecard.editException(exception); wwtFocusPanelSVC.togglePanel('newExceptionForm')"
                            class="btn btn-xs btn-link btn-delete-exception btn-exng-click-active">Edit </button>

                    </li>
                </ul>
            </section>
        </div>

        <!-- form starts here -->
        <wwt-focus-panel panel-name="'newExceptionForm'" position="'right'" header-text="'New Exception'"
            header-icon="'plus-circle'" backdrop="true">
            <main class="container new-asset-form">

                <form name="newExceptionForm" ng-submit="APIScorecard.addException();">
                    <div class="fp-form-validation-msg warning allow-ng-animate">
                        <p> We recommend reading our cook-book on<a
                                href="https://github.wwt.com/custom-apps/endpoint-security-analyzer/blob/master/README.md"
                                target="_blank" title="API Exception Cook-Book">
                                Endpoint Exceptions</a> to learn what an exception is and how best to create one.</p>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="form-group">
                        <label>API ID</label>
                        <input ng-model="APIScorecard.apiId" required="false" id="apiId" placeholder="1"
                            autocomplete="on" ng-disabled=true />
                    </div>
                    <div class="form-group">
                        <label id="name">METHOD</label>
                        <p>
                            <small>The HTTP Method (GET, PUT, POST) for the Exception</small>
                        </p>
                        <label>
                            <input type="radio" ng-model="APIScorecard.isEditingException.method" value="GET">
                            GET
                        </label> <br />
                        <label>
                            <input type="radio" ng-model="APIScorecard.isEditingException.method" value="POST">
                            POST
                        </label><br />
                        <label>
                            <input type="radio" ng-model="APIScorecard.isEditingException.method" value="PUT">
                            PUT
                        </label>
                    </div>

                    <div class="form-group required">
                        <label id="name">URL</label>
                        <p>
                            <small>The Alert URL to be excluded from the score.</small>
                        </p>
                        <input ng-model="APIScorecard.isEditingException.urlPathPattern" required="true" id="inputName"
                            placeholder="Ex: /users" autocomplete="off" />
                    </div>

                    <section class="fp-footer">
                        <div class="form-actions split flex-1" ng-if="!APIScorecard.isPromptingToDeleteException">
                            <section>
                                <button class="btn btn-primary" type="submit" ng-disabled="!newExceptionForm.$valid"
                                    ng-click="wwtFocusPanelSVC.closePanel('newExceptionForm')"> Submit</button>
                                <a class="btn btn-link"
                                    ng-click="wwtFocusPanelSVC.closePanel('newExceptionForm'); APIScorecard.isPromptingToDeleteException = false">
                                    Cancel</a>
                            </section>
                            <section ng-if="!APIScorecard.isEditingException.isAddingNewException">
                                <a class="btn btn-link" ng-click="APIScorecard.isPromptingToDeleteException = true">
                                    Delete</a>
                            </section>
                        </div>

                        <div class="form-actions inline-prompt delete"
                            ng-if="APIScorecard.isPromptingToDeleteException">
                            <section>
                                <button type="button" class="btn btn-danger"
                                    ng-click="APIScorecard.deleteException(); wwtFocusPanelSVC.closePanel('newExceptionForm')">
                                    Delete</button>
                                <a class="btn btn-link" ng-click="APIScorecard.isPromptingToDeleteException = false">
                                    Cancel</a>
                            </section>

                            <section>
                                <p>Are you sure you want to delete this exception?</p>
                            </section>
                        </div>
                    </section>
                </form>
            </main>
        </wwt-focus-panel>
</div>
